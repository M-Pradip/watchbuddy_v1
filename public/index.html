<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WatcBuddy Navbar</title>
    <link rel="stylesheet" href="css/index.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />

    <!-- Socket.IO Client -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/auth.js"></script>
    <script src="js/navigation.js"></script>
    <!-- Fast Socket.IO based room management -->
    <script src="js/fast-room-manager.js"></script>
    <script src="js/room-interface.js"></script>
  </head>

  <body>
    <header>
      <nav class="navbar">
        <div class="nav-box">
          <div class="logo">
            <a href="/index.html">
              <img
                src="/assests/mainlogo.png"
                alt="watchbuddy logo"
                class="logo-img"
              />
              <span>WatchBuddy</span>
            </a>
          </div>
          <ul class="nav-links">
            <li><a href="pricing.html">Pricing</a></li>
            <li><a href="features.html">Features</a></li>

            <div class="auth-buttons">
              <li><a href="login.html" id="loginLink">Log In</a></li>
              <li id="userDropdown" class="user-dropdown">
                <button class="user-btn" id="userDropdownBtn">
                  <img id="userAvatar" src="" alt="User" class="user-avatar" />
                  <span class="user-status-indicator"></span>
                </button>
                <div class="user-dropdown-content" id="userDropdownContent">
                  <div class="user-dropdown-header">
                    <img
                      id="userDropdownAvatar"
                      src=""
                      alt="User"
                      class="user-dropdown-avatar"
                    />
                    <div class="user-dropdown-info">
                      <div id="userName" class="user-dropdown-name">
                        Loading...
                      </div>
                      <div id="userEmail" class="user-dropdown-email">
                        loading@example.com
                      </div>
                    </div>
                  </div>
                  <a href="#" class="user-dropdown-item">
                    <i class="fas fa-user"></i> My Profile
                  </a>
                  <a href="#" class="user-dropdown-item">
                    <i class="fas fa-cog"></i> Settings
                  </a>
                  <div class="user-dropdown-divider"></div>
                  <a href="#" class="user-dropdown-item" id="signOutBtn">
                    <i class="fas fa-sign-out-alt"></i> Sign Out
                  </a>
                </div>
              </li>
            </div>
          </ul>
        </div>
      </nav>
    </header>
    <div class="watch">
      <h1>Watch Videos</h1>
      <h1>Together</h1>
      <p class="text">
        Create or join a room to watch<br />Youtube or uploaded videos<br />in
        sync with others
      </p>
    </div>
    <div class="button-container">
      <button class="Create" id="createRoomBtn">Create a Room</button>
      <input class="Code" placeholder="Enter a code" />
      <button class="Join">Join</button>
    </div>
    <div class="feature-grid">
      <div class="feature-container">
        <div class="feature-title">
          <img src="/assests/playbutton.avif" alt="Play Icon" class="icon" />
          <span>"Synchronized Playback"</span>
        </div>
        <div class="description">
          Watch videos in with one host controlling playback.
        </div>
      </div>
      <div class="feature-container">
        <div class="feature-title">
          <img src="/assests/room.jpg" alt="Room Icon" class="icon" />
          <span>Private Rooms</span>
        </div>
        <div class="description">
          Choose between public or private rooms to watch with friends or the
          community.
        </div>
      </div>

      <div class="feature-container">
        <div class="feature-title">
          <img src="/assests/youtube.jpg" alt="Youtube Icon" class="icon" />
          <span>Youtube or Your Videos</span>
        </div>
        <div class="description">
          Watch content from Youtube or your own videos.
        </div>
      </div>
      <div class="feature-container">
        <div class="feature-title">
          <img src="/assests/chat.jpg" alt="chat icon" class="icon" />
          <span>Live Chat</span>
        </div>
        <div class="description">
          Chat with other viewers in real time while watching.
        </div>
      </div>
    </div>

    <!-- Modal for Create Room -->
    <div id="createRoomModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Create a Room</h2>
        <form id="joinRoom" action="admin.html">
          <input
            type="number"
            name="room"
            id="room"
            placeholder="Enter room number"
            required
          />
          <input
            type="text"
            name="username"
            id="username"
            placeholder="Enter your name"
            required
          />
          <button type="submit" class="btn">Join Room</button>
        </form>
      </div>
    </div>

    <footer class="site-footer">
      <div class="footer-container">
        <div class="footer-column">
          <h4>Company</h4>
          <ul>
            <li><a href="#">About us</a></li>
            <li><a href="#">Carrers</a></li>
            <li><a href="#">BLog</a></li>
          </ul>
        </div>
        <div class="footer-column">
          <h4>Features</h4>
          <ul>
            <li><a href="#">Synchronized Playback</a></li>
            <li><a href="#">Private Rooms</a></li>
            <li><a href="#">Live chat</a></li>
          </ul>
        </div>
        <div class="footer-column">
          <h4>Support</h4>
          <ul>
            <li><a href="#">Help Center</a></li>
            <li><a href="#">Contact Us </a></li>
            <li><a href="#"> Report a Bug</a></li>
          </ul>
        </div>
        <div class="footer-column">
          <h4>Connect</h4>
          <ul>
            <li><a href="#">Twitter</a></li>
            <li><a href="#"> Discord</a></li>
            <li><a href="#"> Instaram</a></li>
          </ul>
        </div>
      </div>
      <div class="footer bottom">
        <span> 2025 Watch-Together Inc.All rights reserved.</span>
      </div>
    </footer>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/qs/6.10.1/qs.min.js"
      integrity="sha512-aTKlYRb1QfU1jlF3k+aS4AqTpnTXci4R79mkdie/bp6Xm51O5O3ESAYhvg6zoicj/PD6VYY0XrYwsWLcvGiKZQ=="
      crossorigin="anonymous"
    ></script>
    <script src="js/app.js"></script>
    <script>
      // Modal functionality
      const modal = document.getElementById("createRoomModal");
      const createBtn = document.getElementById("createRoomBtn");
      const joinBtn = document.querySelector(".Join");
      const closeBtn = document.querySelector(".close");

      // Function to check if user is logged in
      function isUserLoggedIn() {
        return window.authManager && window.authManager.currentUser;
      }

      // Open modal when Create a Room button is clicked (check login first)
      createBtn.addEventListener("click", function () {
        if (!isUserLoggedIn()) {
          alert("Please login first to create a room!");
          return;
        }

        // Auto-fill username from logged-in user
        const userName =
          window.authManager.currentUser.user_metadata?.username ||
          window.authManager.currentUser.user_metadata?.name ||
          window.authManager.currentUser.email.split("@")[0];

        document.getElementById("username").value = userName;
        document.getElementById("username").readOnly = true; // Make it read-only
        document.getElementById("username").style.backgroundColor = "#f8f9fa"; // Light gray background

        modal.style.display = "block";
      });

      // Handle Join button click (check login first)
      joinBtn.addEventListener("click", function () {
        if (!isUserLoggedIn()) {
          alert("Please login first to join a room!");
          return;
        }

        const roomCode = document.querySelector(".Code").value;
        if (roomCode.trim() === "") {
          alert("Please enter a room code");
          return;
        }

        // Get current user's name for the join process
        const userName =
          window.authManager.currentUser.user_metadata?.username ||
          window.authManager.currentUser.user_metadata?.name ||
          window.authManager.currentUser.email.split("@")[0];

        // Redirect to admin page with room code and username
        window.location.href = `admin.html?room=${roomCode}&username=${encodeURIComponent(
          userName
        )}`;
      });

      // Close modal when X is clicked
      closeBtn.addEventListener("click", function () {
        modal.style.display = "none";
        // Reset username field
        document.getElementById("username").value = "";
        document.getElementById("username").readOnly = false;
        document.getElementById("username").style.backgroundColor = "";
      });

      // Close modal when clicking outside of it
      window.addEventListener("click", function (event) {
        if (event.target === modal) {
          modal.style.display = "none";
          // Reset username field
          document.getElementById("username").value = "";
          document.getElementById("username").readOnly = false;
          document.getElementById("username").style.backgroundColor = "";
        }
      });

      // Handle form submission in modal
      document
        .getElementById("joinRoom")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const roomNumber = document.getElementById("room").value;
          const username = document.getElementById("username").value;

          if (roomNumber && username) {
            // Redirect to admin page with the form data
            window.location.href = `admin.html?room=${roomNumber}&username=${encodeURIComponent(
              username
            )}`;
          }
        });
    </script>
  </body>
</html>
